<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ToDo List</title>
  <style>
    /* 1. Root Variables */
    :root {
        --mui-primary: #6200ee;
        --mui-secondary: #03dac6;
        --mui-bg: #f0f0f9;
        --mui-surface: #f2f2f7;
        --mui-text: #1c1c1e;
        --mui-radius: 12px;
        --mui-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        --mui-transition: 0.2s ease;
        --mui-font: 'Roboto', sans-serif;
    }

    [data-theme="dark"] {
        --mui-bg: #121212;
        --mui-surface: #1e1e1e;
        --mui-text: #e0e0e0;
        --mui-shadow: 0 2px 8px rgba(255, 255, 255, 0.05);
    }

    /* 2. Global Styles */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: var(--mui-font);
        transition: var(--mui-transition);
    }

    body {
        background: var(--mui-bg);
        color: var(--mui-text);
        font-family: var(--mui-font);
        line-height: 1.6;
        font-size: 16px;
        padding: 0;
        margin: 0;
        min-height: 100vh;
        transition: var(--mui-transition);
    }

    /* Not Sonnet */

    nav a {
      display: inline-block;
      padding: 6px 12px;
      margin-left: 8px;
      border-radius: 4px;
      background-color: #007aff;
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      font-size: 0.9rem;
      transition: background-color 0.2s ease, transform 0.1s ease;
    }

    nav a:hover {
      background-color: #005bb5;
      transform: scale(1.05);
    }

    nav a:active {
      background-color: #004999;
      transform: scale(0.97);
    }

    nav {
      margin-left: auto;
      margin-right: 24px;
    }

    /* 3. Components */
    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* Navbar */
    .mui-navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 24px;
        background: var(--mui-surface);
        box-shadow: var(--mui-shadow);
    }

    /* Container */
    .mui-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 24px;
        background: var(--mui-bg);
    }

    /* Card */
    .mui-card {
        background: var(--mui-surface);
        border-radius: var(--mui-radius);
        box-shadow: var(--mui-shadow);
        padding: 16px 20px;
        margin: 16px 0;
        transition: var(--mui-transition);
    }

    .mui-card:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .flex-row {
        display: flex;
        flex-direction: row;
    }

    .gap-10 {
        gap: 10px;
    }

    /* Button */
    .mui-btn {
        display: inline-block;
        padding: 10px 20px;
        font-size: 15px;
        font-weight: 500;
        color: white;
        background: var(--mui-primary);
        border: none;
        border-radius: var(--mui-radius);
        cursor: pointer;
        transition: var(--mui-transition);
    }

    .mui-btn:hover {
        background: #3700b3;
    }

    .mui-btn:active {
        transform: scale(0.98);
    }

    /* Small Danger Button */
    .mui-btn-small {
        padding: 6px 12px;
        font-size: 13px;
        border-radius: calc(var(--mui-radius) / 1.5);
    }

    /* Danger Button */
    .mui-btn-danger {
        color: white;
        background: #d32f2f;
    }

    .mui-btn-danger:hover {
        background: #b71c1c;
    }

    /* Input */
    .mui-input {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: var(--mui-radius);
        background: transparent;
        color: var(--mui-text);
        outline: none;
        transition: var(--mui-transition);
    }

    .mui-input:focus {
        border-color: var(--mui-primary);
        box-shadow: 0 0 0 2px rgba(98, 0, 238, 0.1);
    }

    /* List */
    .mui-list {
        list-style: none;
        margin: 0;
        padding: 0;
        background: var(--mui-surface);
        border-radius: var(--mui-radius);
        overflow: hidden;
    }

    /* List Item */
    .mui-item {
        padding: 12px 16px;
        font-size: 16px;
        color: var(--mui-text);
        cursor: pointer;
        transition: background-color var(--mui-transition);
    }

    .mui-item:not(:last-child) {
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    [data-theme="dark"] .mui-item:not(:last-child) {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .mui-item:hover {
        background: rgba(0, 0, 0, 0.05);
    }

    [data-theme="dark"] .mui-item:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    /* Toggle Switch */
    .mui-switch {
        position: relative;
        width: 50px;
        height: 28px;
        display: inline-block;
    }

    .mui-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .mui-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: var(--mui-transition);
        border-radius: 28px;
    }

    .mui-slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 3px;
        top: 3px;
        background-color: white;
        transition: var(--mui-transition);
        border-radius: 50%;
    }

    .mui-switch input:checked+.mui-slider {
        background-color: var(--mui-primary);
    }

    .mui-switch input:checked+.mui-slider:before {
        transform: translateX(22px);
    }

    /* Typography */
    h1, h2, h3, h4 {
        font-weight: 500;
        margin: 12px 0;
        color: var(--mui-text);
    }

    .completed {
      text-decoration: line-through;
      opacity: 0.6;
    }

    /* Utilities */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    .hidden {
        display: none;
    }

    .todo-actions {
        display: flex;
        gap: 8px;
    }

    .empty-state {
        text-align: center;
        padding: 24px;
        color: #888;
    }

    .filter-container {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        gap: 10px;
    }

    .filter-btn {
        padding: 6px 12px;
        background: transparent;
        border: 1px solid var(--mui-primary);
        color: var(--mui-primary);
        border-radius: var(--mui-radius);
        cursor: pointer;
        transition: var(--mui-transition);
    }

    .filter-btn.active {
        background: var(--mui-primary);
        color: white;
    }
    
    .edit-form {
        width: 100%;
    }
    
    .edit-input {
        flex: 1;
    }
  </style>
</head>

<body>
  <header class="mui-navbar">
    <h1>ToDo List</h1>
    <h2 style="margin-left: auto;">Sonnet's V2</h2>
      <nav>
        <a href="index_v1.html" class="mui-btn-small">Sonnet's v1</a>
        <a href="index_v0.html" class="mui-btn-small">Version 0</a>
      </nav>
    <!-- Dark mode toggle -->
    <label class="mui-switch">
      <input type="checkbox" id="themeToggle">
      <span class="mui-slider"></span>
      <span class="sr-only">Toggle Theme</span>
    </label>
  </header>

  <div class="mui-container">
    <div class="mui-card">
      <div class="flex-row gap-10">
        <input type="text" id="todoInput" class="mui-input" placeholder="Add new task...">
        <button class="mui-btn" id="addTodo">Add</button>
      </div>
    </div>
  </div>

  <div class="mui-container">
    <div class="mui-card">
      <div class="filter-container">
        <div>
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="active">Active</button>
          <button class="filter-btn" data-filter="completed">Completed</button>
        </div>
        <button id="clearCompleted" class="mui-btn-small mui-btn-danger">Clear Completed</button>
      </div>
      
      <div id="todoStats" class="flex-between">
        <span id="todoCount">0 items left</span>
      </div>
      
      <ul id="todoList" class="mui-list">
        <!-- Todo items will be dynamically added here -->
      </ul>
      
      <div id="emptyState" class="empty-state">
        <p>No todos yet. Add one above!</p>
      </div>
    </div>
  </div>

  <script>
    // Todo app with a simpler approach and edit functionality

    // Store DOM elements
    const elements = {
      todoList: document.getElementById("todoList"),
      todoInput: document.getElementById("todoInput"),
      addButton: document.getElementById("addTodo"),
      todoCount: document.getElementById("todoCount"),
      clearCompletedBtn: document.getElementById("clearCompleted"),
      filterButtons: document.querySelectorAll(".filter-btn"),
      emptyState: document.getElementById("emptyState"),
      themeToggle: document.getElementById("themeToggle")
    };

    // State management
    const todoApp = {
      todos: JSON.parse(localStorage.getItem('todos')) || [],
      currentFilter: 'all',
      
      // Save todos to localStorage
      saveTodos: function() {
        localStorage.setItem('todos', JSON.stringify(this.todos));
        this.renderTodos();
      },
      
      // Add a new todo
      addTodo: function(text) {
        const todo = {
          id: Date.now().toString(),
          text: text,
          completed: false,
          isEditing: false
        };
        
        this.todos.push(todo);
        this.saveTodos();
      },
      
      // Delete a todo by ID
      deleteTodo: function(id) {
        this.todos = this.todos.filter(todo => todo.id !== id);
        this.saveTodos();
      },
      
      // Toggle completed status
      toggleTodo: function(id) {
        this.todos = this.todos.map(todo => {
          if (todo.id === id) {
            return {
              ...todo,
              completed: !todo.completed
            };
          }
          return todo;
        });
        this.saveTodos();
      },
      
      // Start editing a todo
      startEditTodo: function(id) {
        // First cancel any current editing
        this.cancelEditTodo();
        
        // Set the todo to editing mode
        this.todos = this.todos.map(todo => {
          if (todo.id === id) {
            return {
              ...todo,
              isEditing: true
            };
          }
          return todo;
        });
        this.renderTodos();
        
        // Focus the edit input after rendering
        setTimeout(() => {
          const editInput = document.querySelector(`li[data-id="${id}"] .edit-input`);
          if (editInput) {
            editInput.focus();
            editInput.select();
          }
        }, 10);
      },
      
      // Save edited todo text
      saveEditTodo: function(id, newText) {
        this.todos = this.todos.map(todo => {
          if (todo.id === id) {
            return {
              ...todo,
              text: newText,
              isEditing: false
            };
          }
          return todo;
        });
        this.saveTodos();
      },
      
      // Cancel editing
      cancelEditTodo: function() {
        this.todos = this.todos.map(todo => {
          if (todo.isEditing) {
            return {
              ...todo,
              isEditing: false
            };
          }
          return todo;
        });
        this.renderTodos();
      },
      
      // Set filter
      setFilter: function(filter) {
        this.currentFilter = filter;
        this.renderTodos();
      },
      
      // Clear completed todos
      clearCompleted: function() {
        this.todos = this.todos.filter(todo => !todo.completed);
        this.saveTodos();
      },
      
      // Get filtered todos
      getFilteredTodos: function() {
        switch(this.currentFilter) {
          case 'active':
            return this.todos.filter(todo => !todo.completed);
          case 'completed':
            return this.todos.filter(todo => todo.completed);
          default:
            return this.todos;
        }
      },
      
      // Create a todo list item element
      createTodoElement: function(todo) {
        const li = document.createElement('li');
        li.className = `mui-item flex-between ${todo.completed ? 'completed' : ''}`;
        li.dataset.id = todo.id;
        
        if (todo.isEditing) {
          // Edit mode
          const editForm = document.createElement('form');
          editForm.className = 'edit-form full-width flex-row gap-10';
          editForm.dataset.id = todo.id;
          
          const editInput = document.createElement('input');
          editInput.className = 'mui-input edit-input';
          editInput.value = todo.text;
          
          const saveButton = document.createElement('button');
          saveButton.textContent = 'Save';
          saveButton.className = 'mui-btn-small';
          saveButton.type = 'submit';
          
          const cancelButton = document.createElement('button');
          cancelButton.textContent = 'Cancel';
          cancelButton.className = 'mui-btn-small mui-btn-danger';
          cancelButton.type = 'button';
          cancelButton.dataset.action = 'cancel-edit';
          
          editForm.appendChild(editInput);
          editForm.appendChild(saveButton);
          editForm.appendChild(cancelButton);
          li.appendChild(editForm);
        } else {
          // Normal mode
          const span = document.createElement('span');
          span.textContent = todo.text;
          if (todo.completed) span.classList.add('completed');
          
          const actionsDiv = document.createElement('div');
          actionsDiv.className = 'todo-actions';
          
          const editButton = document.createElement('button');
          editButton.textContent = 'Edit';
          editButton.className = 'mui-btn-small';
          editButton.dataset.action = 'edit';
          
          const completeButton = document.createElement('button');
          completeButton.textContent = todo.completed ? 'Undo' : 'Complete';
          completeButton.className = `mui-btn-small ${todo.completed ? '' : 'mui-btn-primary'}`;
          completeButton.dataset.action = 'toggle';
          
          const deleteButton = document.createElement('button');
          deleteButton.textContent = 'Delete';
          deleteButton.className = 'mui-btn-small mui-btn-danger';
          deleteButton.dataset.action = 'delete';
          
          actionsDiv.appendChild(editButton);
          actionsDiv.appendChild(completeButton);
          actionsDiv.appendChild(deleteButton);
          
          li.appendChild(span);
          li.appendChild(actionsDiv);
        }
        
        return li;
      },
      
      // Render todos in the list
      renderTodos: function() {
        const filteredTodos = this.getFilteredTodos();
        
        // Clear list
        elements.todoList.innerHTML = '';
        
        if (filteredTodos.length === 0) {
          elements.emptyState.classList.remove('hidden');
          elements.todoList.classList.add('hidden');
        } else {
          elements.emptyState.classList.add('hidden');
          elements.todoList.classList.remove('hidden');
          
          // Create todo items
          filteredTodos.forEach(todo => {
            elements.todoList.appendChild(this.createTodoElement(todo));
          });
        }
        
        // Update counter
        const activeTodos = this.todos.filter(todo => !todo.completed).length;
        elements.todoCount.textContent = `${activeTodos} item${activeTodos !== 1 ? 's' : ''} left`;
      },
      
      // Initialize the app
      init: function() {
        // Set up event listeners
        
        // Add todo
        elements.addButton.addEventListener('click', () => {
          const text = elements.todoInput.value.trim();
          if (text) {
            this.addTodo(text);
            elements.todoInput.value = '';
          }
        });
        
        elements.todoInput.addEventListener('keydown', event => {
          if (event.key === 'Enter' && elements.todoInput.value.trim()) {
            this.addTodo(elements.todoInput.value.trim());
            elements.todoInput.value = '';
          }
        });
        
        // Todo item actions using event delegation
        elements.todoList.addEventListener('click', event => {
          const target = event.target;
          if (!target.dataset.action) return;
          
          const li = target.closest('li');
          const id = li.dataset.id;
          
          switch(target.dataset.action) {
            case 'delete':
              this.deleteTodo(id);
              break;
            case 'toggle':
              this.toggleTodo(id);
              break;
            case 'edit':
              this.startEditTodo(id);
              break;
            case 'cancel-edit':
              this.cancelEditTodo();
              break;
          }
        });
        
        // Handle form submission for editing
        elements.todoList.addEventListener('submit', event => {
          event.preventDefault();
          const form = event.target;
          if (form.classList.contains('edit-form')) {
            const id = form.dataset.id;
            const input = form.querySelector('.edit-input');
            const newText = input.value.trim();
            
            if (newText) {
              this.saveEditTodo(id, newText);
            }
          }
        });
        
        // Handle escape key to cancel editing
        document.addEventListener('keydown', event => {
          if (event.key === 'Escape') {
            this.cancelEditTodo();
          }
        });
        
        // Filter buttons
        elements.filterButtons.forEach(button => {
          button.addEventListener('click', () => {
            elements.filterButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            this.setFilter(button.dataset.filter);
          });
        });
        
        // Clear completed
        elements.clearCompletedBtn.addEventListener('click', () => {
          this.clearCompleted();
        });
        
        // Theme toggle
        elements.themeToggle.addEventListener('change', () => {
          document.documentElement.setAttribute(
            'data-theme', 
            elements.themeToggle.checked ? 'dark' : 'light'
          );
          localStorage.setItem('theme', elements.themeToggle.checked ? 'dark' : 'light');
        });
        
        // Set theme based on localStorage or system preference
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
          elements.themeToggle.checked = savedTheme === 'dark';
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.setAttribute('data-theme', 'dark');
          elements.themeToggle.checked = true;
        }
        
        // Initial render
        this.renderTodos();
      }
    };
    
    // Initialize the app
    todoApp.init();
  </script>
</body>
</html>
